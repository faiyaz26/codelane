/* XTerm.js styles - must be first */
@import '@xterm/xterm/css/xterm.css';

@tailwind base;
@tailwind components;
@tailwind utilities;

/* CSS Variables for theming */
/* Colors that need opacity support use RGB channels (space-separated) */
/* Colors without opacity support use hex values */

/* Dark Theme - Deep blacks (default) */
:root.dark {
  /* Backgrounds */
  --zed-bg-app: 10 10 10;
  --zed-bg-panel: 17 17 17;
  --zed-bg-surface: 26 26 26;
  --zed-bg-hover: 31 31 31;
  --zed-bg-active: 37 37 37;
  --zed-bg-overlay: 42 42 42;

  /* Borders */
  --zed-border-subtle: 26 26 26;
  --zed-border-default: 37 37 37;
  --zed-border-focus: 58 58 58;
  --zed-border-active: 11 147 246;

  /* Text */
  --zed-text-primary: 230 230 230;
  --zed-text-secondary: 158 158 158;
  --zed-text-tertiary: 110 110 110;
  --zed-text-disabled: 78 78 78;
  --zed-text-inverse: 10 10 10;

  /* Accents */
  --zed-accent-blue: 11 147 246;
  --zed-accent-blue-hover: 13 123 217;
  --zed-accent-green: 38 217 127;
  --zed-accent-green-hover: 32 184 105;
  --zed-accent-yellow: 245 194 73;
  --zed-accent-red: 242 60 60;
  --zed-accent-red-hover: 217 50 50;
  --zed-accent-purple: 184 142 242;
  --zed-accent-orange: 255 140 66;

  /* Semantic */
  --zed-success: 38 217 127;
  --zed-warning: 245 194 73;
  --zed-error: 242 60 60;
  --zed-info: 11 147 246;
}

/* Codelane Dark Theme - Codelane's signature dark theme */
:root.codelane-dark {
  /* Backgrounds */
  --zed-bg-app: 32 35 41;
  --zed-bg-panel: 38 42 50;
  --zed-bg-surface: 47 52 62;
  --zed-bg-hover: 56 60 70;
  --zed-bg-active: 62 68 82;
  --zed-bg-overlay: 43 48 56;

  /* Borders */
  --zed-border-subtle: 43 48 56;
  --zed-border-default: 56 60 70;
  --zed-border-focus: 74 79 90;
  --zed-border-active: 93 139 186;

  /* Text */
  --zed-text-primary: 187 191 195;
  --zed-text-secondary: 146 151 161;
  --zed-text-tertiary: 108 110 122;
  --zed-text-disabled: 74 79 90;
  --zed-text-inverse: 32 35 41;

  /* Accents */
  --zed-accent-blue: 93 139 186;
  --zed-accent-blue-hover: 74 127 176;
  --zed-accent-green: 129 154 103;
  --zed-accent-green-hover: 114 143 87;
  --zed-accent-yellow: 179 154 106;
  --zed-accent-red: 166 91 95;
  --zed-accent-red-hover: 157 76 80;
  --zed-accent-purple: 144 95 166;
  --zed-accent-orange: 153 119 85;

  /* Semantic */
  --zed-success: 129 154 103;
  --zed-warning: 179 154 106;
  --zed-error: 166 91 95;
  --zed-info: 93 139 186;
}

/* Light Theme - Clean and bright */
:root.light {
  /* Backgrounds */
  --zed-bg-app: 255 255 255;
  --zed-bg-panel: 248 249 250;
  --zed-bg-surface: 241 243 244;
  --zed-bg-hover: 232 234 237;
  --zed-bg-active: 223 225 229;
  --zed-bg-overlay: 255 255 255;

  /* Borders */
  --zed-border-subtle: 232 234 237;
  --zed-border-default: 218 220 224;
  --zed-border-focus: 196 199 204;
  --zed-border-active: 26 115 232;

  /* Text */
  --zed-text-primary: 32 33 36;
  --zed-text-secondary: 95 99 104;
  --zed-text-tertiary: 128 134 139;
  --zed-text-disabled: 184 187 193;
  --zed-text-inverse: 255 255 255;

  /* Accents */
  --zed-accent-blue: 26 115 232;
  --zed-accent-blue-hover: 21 87 176;
  --zed-accent-green: 24 128 56;
  --zed-accent-green-hover: 19 109 46;
  --zed-accent-yellow: 249 171 0;
  --zed-accent-red: 217 48 37;
  --zed-accent-red-hover: 179 38 30;
  --zed-accent-purple: 147 52 230;
  --zed-accent-orange: 232 113 10;

  /* Semantic */
  --zed-success: 24 128 56;
  --zed-warning: 249 171 0;
  --zed-error: 217 48 37;
  --zed-info: 26 115 232;
}

/* Base styles */
@layer base {
  * {
    @apply border-zed-border-default;
  }

  html {
    @apply antialiased;
  }

  body {
    @apply m-0 font-sans bg-zed-bg-app text-zed-text-primary overflow-hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  code {
    @apply font-mono;
  }

  /* Scrollbar styling (Zed-like) */
  ::-webkit-scrollbar {
    @apply w-2 h-2;
  }

  ::-webkit-scrollbar-track {
    @apply bg-transparent;
  }

  ::-webkit-scrollbar-thumb {
    @apply bg-zed-border-focus rounded-full;
  }

  ::-webkit-scrollbar-thumb:hover {
    @apply bg-zed-border-active;
  }

  /* Selection */
  ::selection {
    @apply bg-zed-accent-blue/30;
  }

  /* Focus rings */
  *:focus-visible {
    @apply outline-none ring-2 ring-zed-accent-blue ring-offset-2 ring-offset-zed-bg-app;
  }

  /* Screen reader only - accessible hiding */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  /* Accessible focus for skip links and similar elements */
  .sr-only:focus,
  .sr-only:focus-visible {
    position: static;
    width: auto;
    height: auto;
    padding: inherit;
    margin: inherit;
    overflow: visible;
    clip: auto;
    white-space: normal;
  }

  /* Not screen reader only - use when you want to show on focus */
  .not-sr-only {
    position: static;
    width: auto;
    height: auto;
    padding: inherit;
    margin: inherit;
    overflow: visible;
    clip: auto;
    white-space: normal;
  }

  /* Focus visible specifically for keyboard users (not mouse) */
  .focus-visible-only:focus:not(:focus-visible) {
    outline: none;
    box-shadow: none;
  }
}

/* Custom utilities */
@layer utilities {
  /* Hide scrollbar but allow scrolling */
  .scrollbar-none {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-none::-webkit-scrollbar {
    display: none;
  }
}

/* Component utilities */
@layer components {
  .panel {
    @apply bg-zed-bg-panel border border-zed-border-default rounded-lg;
  }

  .surface {
    @apply bg-zed-bg-surface border border-zed-border-default rounded-md;
  }

  /* Common panel header style */
  .panel-header {
    @apply h-9 px-3 flex items-center border-b border-zed-border-subtle flex-shrink-0;
  }

  .panel-header-title {
    @apply text-xs font-semibold text-zed-text-secondary uppercase tracking-wide;
  }

  .btn-primary {
    @apply px-4 py-2 bg-zed-accent-blue hover:bg-zed-accent-blue-hover text-white rounded-md font-medium transition-colors;
  }

  .btn-secondary {
    @apply px-4 py-2 bg-zed-bg-surface hover:bg-zed-bg-hover border border-zed-border-default text-zed-text-primary rounded-md font-medium transition-colors;
  }

  .btn-danger {
    @apply px-4 py-2 bg-zed-accent-red hover:bg-zed-accent-red-hover text-white rounded-md font-medium transition-colors;
  }

  .input {
    @apply px-3 py-2 bg-zed-bg-surface border border-zed-border-default rounded-md text-zed-text-primary placeholder:text-zed-text-tertiary focus:border-zed-accent-blue transition-colors;
  }
}

/* Terminal overrides */
.xterm {
  padding: 8px;
  height: 100%;
}

.xterm .xterm-viewport {
  overflow-y: auto;
}

.xterm .xterm-screen {
  cursor: text;
}

/* Hide xterm scrollbar and use browser default */
.xterm .xterm-viewport::-webkit-scrollbar {
  width: 8px;
}

.xterm .xterm-viewport::-webkit-scrollbar-track {
  background: transparent;
}

.xterm .xterm-viewport::-webkit-scrollbar-thumb {
  background: rgb(var(--zed-border-focus));
  border-radius: 4px;
}

.xterm .xterm-viewport::-webkit-scrollbar-thumb:hover {
  background: rgb(var(--zed-accent-blue));
}

/* Shiki syntax highlighting styles */
.shiki-container {
  font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
  font-size: 13px;
  line-height: 1.5;
  height: 100%;
}

.shiki-container pre.shiki {
  margin: 0;
  padding: 8px 0;
  background-color: rgb(var(--zed-bg-surface)) !important;
  overflow-x: auto;
  height: 100%;
}

.shiki-container code {
  display: block;
  counter-reset: line;
}

.shiki-container code .line {
  display: inline-block;
  width: 100%;
  padding: 0 16px 0 0;
  line-height: 1.5;
}

.shiki-container code .line::before {
  counter-increment: line;
  content: counter(line);
  display: inline-block;
  width: 3.5em;
  margin-right: 1em;
  padding-right: 0.75em;
  text-align: right;
  color: rgb(var(--zed-text-disabled));
  border-right: 1px solid rgb(var(--zed-border-default));
  user-select: none;
}

.shiki-container code .line:hover {
  background-color: rgb(var(--zed-bg-hover));
}

/* Custom Shiki container with code folding */
.shiki-container-custom {
  font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
  font-size: 13px;
  line-height: 1.5;
  margin: 0;
  padding: 8px 0;
  background-color: rgb(var(--zed-bg-surface));
  overflow-x: auto;
  min-height: 100%;
}

.shiki-container-custom code {
  display: block;
}

.shiki-container-custom .code-line {
  display: flex;
  align-items: center;
  height: 20px; /* Must match LINE_HEIGHT in FileViewer.tsx for virtualization */
  padding-right: 16px;
  box-sizing: border-box;
}

.shiki-container-custom .code-line:hover {
  background-color: rgb(var(--zed-bg-hover));
}

.shiki-container-custom .code-line.folded {
  background-color: rgb(var(--zed-bg-hover) / 0.5);
}

/* Fold gutter */
.shiki-container-custom .fold-gutter {
  width: 1.5em;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
}

.shiki-container-custom .fold-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 1em;
  height: 1em;
  color: rgb(var(--zed-text-disabled));
  opacity: 0;
  transition: opacity 0.15s, color 0.15s;
  cursor: pointer;
  border: none;
  background: none;
  padding: 0;
}

.shiki-container-custom .code-line:hover .fold-button,
.shiki-container-custom .fold-button.is-folded {
  opacity: 1;
}

.shiki-container-custom .fold-button:hover {
  color: rgb(var(--zed-text-primary));
}

.shiki-container-custom .fold-button.is-folded {
  color: rgb(var(--zed-accent-blue));
}

/* Line numbers */
.shiki-container-custom .line-number {
  width: 3em;
  flex-shrink: 0;
  padding-right: 0.75em;
  text-align: right;
  color: rgb(var(--zed-text-disabled));
  border-right: 1px solid rgb(var(--zed-border-default));
  user-select: none;
  margin-right: 1em;
}

/* Line content */
.shiki-container-custom .line-content {
  flex: 1;
  white-space: pre;
}

/* Fold indicator */
.shiki-container-custom .fold-indicator {
  display: inline-flex;
  align-items: center;
  margin-left: 0.5em;
  padding: 0 0.5em;
  font-size: 0.85em;
  color: rgb(var(--zed-text-tertiary));
  background-color: rgb(var(--zed-bg-active));
  border-radius: 3px;
  user-select: none;
}

/* Search match highlighting */
.search-match {
  background-color: rgb(var(--zed-accent-yellow) / 0.3);
  border-radius: 2px;
  padding: 1px 0;
}

.search-match-current {
  background-color: rgb(var(--zed-accent-yellow) / 0.6);
  outline: 1px solid rgb(var(--zed-accent-yellow));
}
